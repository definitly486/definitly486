#!/usr/local/bin/bash

# price_change.sh — на сколько процентов выросла/упала цена
# Работает в любой локали (даже если у тебя LC_NUMERIC=ru_RU)

if [ $# -ne 2 ]; then
    echo "Использование: $0 <старая_цена> <новая_цена>"
    echo "Пример: $0 45 100"
    exit 1
fi

old="$1"
new="$2"

# Проверяем, что числа — действительно числа
if ! [[ "$old" =~ ^[0-9]+([.,][0-9]+)?$ ]] || ! [[ "$new" =~ ^[0-9]+([.,][0-9]+)?$ ]]; then
    echo "Ошибка: передавай только положительные числа!"
    exit 1
fi

# Если старая цена = 0 — бесконечный рост
if (( $(echo "$old == 0" | bc -l 2>/dev/null) )); then
    echo "Старая цена: 0 ₽ → Новая цена: $new ₽"
    echo -e "\033[32mИзменение  : +∞ %\033[0m  (из ничего во что-то!)"
    exit 0
fi

# Принудительно используем точку как разделитель и C-локаль для bc
change=$(LC_ALL=C printf "scale=6; ($new - $old) * 100 / $old\n" | bc -l)
change_rounded=$(LC_ALL=C printf "%.2f" "$change")

# Определяем знак и цвет
if (( $(echo "$change >= 0" | bc -l) )); then
    sign="+"
    color="\033[32m"   # зелёный
    arrow="▲"
else
    sign=""
    color="\033[31m"   # красный
    arrow="▼"
fi

# Красивый вывод
echo "Старая цена: $old ₽"
echo "Новая цена : $new ₽"
echo -e "${color}${arrow} Изменение  : $sign${change_rounded}% \033[0m"

# Примеры:
# ./price_change.sh 45 100
# Старая цена: 45 ₽
# Новая цена : 100 ₽
# ▲ Изменение  : +122.22%